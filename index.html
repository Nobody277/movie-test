<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Movie Night Player</title>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    :root {
      --bg-gradient: linear-gradient(135deg,#000,#2e003e);
      --fg: #e0e0e0;
      --accent: #9b00ff;
      --input-bg: #1a1a1a;
      --input-border: #3e003f;
      --card-shadow: rgba(0,0,0,0.7);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      font-family: 'Roboto',sans-serif;
      background: var(--bg-gradient);
      color: var(--fg);
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    #mainContent { display: flex; flex: 1; }
    #videoSection {
      flex: 2;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }
    #chatSidebar {
      flex: 1;
      max-width: 350px;
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(8px);
      display: flex;
      flex-direction: column;
      animation: slideIn 1s ease forwards;
    }
    #videoContainer {
      width: 100%;
      max-width: 900px;
      box-shadow: 0 4px 16px var(--card-shadow);
      border-radius: 8px;
      overflow: hidden;
    }
    #videoPlayer { width: 100%; height: auto; background: #000; }
    #controls {
      margin-top: 1rem;
      display: flex;
      gap: .5rem;
    }
    #videoURL {
      flex: 1;
      max-width: 600px;
      padding: .6rem 1rem;
      font-size: 1rem;
      border: 1px solid var(--input-border);
      border-radius: 6px;
      background: var(--input-bg);
      color: var(--fg);
    }
    button {
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      background: var(--accent);
      color: #fff;
      cursor: pointer;
      transition: transform .2s;
      padding: .6rem 1.2rem;
    }
    button:hover { transform: scale(1.05); }
    #chatHeader { padding: 1rem; font-size: 1.2rem; border-bottom: 1px solid var(--input-border); }
    #chatMessages {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: .75rem;
    }
    .chatMessage {
      padding: .5rem .75rem;
      background: rgba(255,255,255,0.1);
      border-radius: 6px;
      max-width: 80%;
      animation: fadeIn 0.5s ease;
    }
    #chatInputContainer {
      display: flex;
      padding: .75rem;
      border-top: 1px solid var(--input-border);
    }
    #chatInput {
      flex: 1;
      padding: .5rem .75rem;
      border: 1px solid var(--input-border);
      border-radius: 6px;
      background: var(--input-bg);
      color: var(--fg);
    }
    /* Modal */
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      display: flex; align-items: center; justify-content: center;
      opacity: 0; pointer-events: none;
      transition: opacity .3s ease;
    }
    .modal.visible {
      opacity: 1; pointer-events: auto;
    }
    .modalBox {
      background: #1a1a1a;
      border-radius: 8px;
      padding: 1.5rem;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 4px 16px var(--card-shadow);
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .modalHeader { font-size: 1.25rem; }
    #shareURL {
      width: 100%;
      padding: .6rem 1rem;
      border: 1px solid var(--input-border);
      border-radius: 6px;
      background: var(--input-bg);
      color: var(--fg);
    }
    .modalActions { display: flex; justify-content: flex-end; gap: .5rem; }
    #copyBtn { background: var(--fg); color: #000; }
    #closeModal { background: var(--accent); }
    @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body>
  <div id="mainContent">
    <section id="videoSection">
      <div id="videoContainer">
        <video id="videoPlayer" controls preload="metadata" playsinline webkit-playsinline></video>
      </div>
      <div id="controls">
        <input id="videoURL" type="text" placeholder="Paste .mp4 or .m3u8 URL…">
        <button id="loadBtn">Load Video</button>
        <button id="createRoom">Create Room</button>
      </div>
    </section>
    <aside id="chatSidebar">
      <div id="chatHeader">Chat</div>
      <div id="chatMessages"></div>
      <div id="chatInputContainer">
        <input id="chatInput" type="text" placeholder="Type a message…">
        <button id="sendBtn">Send</button>
      </div>
    </aside>
  </div>
  <div id="shareModal" class="modal">
    <div class="modalBox">
      <div class="modalHeader">Share Room Link</div>
      <input id="shareURL" type="text" readonly>
      <div class="modalActions">
        <button id="copyBtn">Copy</button>
        <button id="closeModal">Close</button>
      </div>
    </div>
  </div>
  <script>
    const loadBtn     = document.getElementById('loadBtn');
    const createRoom  = document.getElementById('createRoom');
    const videoURLIn  = document.getElementById('videoURL');
    const videoPlayer = document.getElementById('videoPlayer');
    const shareModal  = document.getElementById('shareModal');
    const shareURL    = document.getElementById('shareURL');
    const copyBtn     = document.getElementById('copyBtn');
    const closeModal  = document.getElementById('closeModal');
    let hls;

    loadBtn.addEventListener('click', () => {
      const url = videoURLIn.value.trim(); if (!url) return;
      if (hls) { hls.destroy(); hls = null; }
      videoPlayer.src = '';
      if (url.includes('.m3u8') && Hls.isSupported()) {
        hls = new Hls(); hls.loadSource(url); hls.attachMedia(videoPlayer);
      } else {
        videoPlayer.src = url;
      }
      videoPlayer.play().catch(()=>{});
    });

    createRoom.addEventListener('click', () => {
      const current = videoPlayer.currentSrc || videoURLIn.value.trim(); if (!current) return;
      const id = Math.random().toString(36).substr(2, 9);
      const link = `${location.origin}${location.pathname}?room=${id}&video=${encodeURIComponent(current)}`;
      shareURL.value = link;
      shareModal.classList.add('visible');
    });

    copyBtn.addEventListener('click', () => {
      navigator.clipboard.writeText(shareURL.value);
    });
    closeModal.addEventListener('click', () => {
      shareModal.classList.remove('visible');
    });

    const params = new URLSearchParams(location.search);
    if (params.has('video')) {
      const v = decodeURIComponent(params.get('video'));
      if (hls) { hls.destroy(); hls = null; }
      videoPlayer.src = '';
      if (v.includes('.m3u8') && Hls.isSupported()) {
        hls = new Hls(); hls.loadSource(v); hls.attachMedia(videoPlayer);
      } else {
        videoPlayer.src = v;
      }
      videoPlayer.play().catch(()=>{});
    }

    const chatInput  = document.getElementById('chatInput');
    const sendBtn    = document.getElementById('sendBtn');
    const chatMsgs   = document.getElementById('chatMessages');
    function appendMessage(text) {
      const el = document.createElement('div'); el.className = 'chatMessage'; el.textContent = text;
      chatMsgs.append(el); chatMsgs.scrollTop = chatMsgs.scrollHeight;
    }
    sendBtn.addEventListener('click', () => {
      const t = chatInput.value.trim(); if (!t) return; appendMessage(t); chatInput.value = '';
    });
    chatInput.addEventListener('keypress', e => { if (e.key === 'Enter') { sendBtn.click(); e.preventDefault(); }});
  </script>
</body>
</html>
